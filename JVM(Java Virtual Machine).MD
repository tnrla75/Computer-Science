## JVM(Java Virtual Machine)

JVM은 2가지 특징을 가진다. 자바 기반 어플리케이션을 어느 OS상에서든 실행될 수 있는것, 운영체제에 구애 받지 않고 프로그램을 실행할 수 있게 도와준다. 가비지 컬렉터를 사용한 프로그램 메모리를 관리하고 최적화한다. 

<br>

### JVM 동작 원리
![](https://www.tcpschool.com/lectures/img_java_programming.png)
1. 자바 소스 파일(.java)은 자바 컴파일러에 의해 바이트 코드(.class)로 변환됩니다.
    + 자바 바이트 코드는 컴퓨터는 읽지 못하고 JVM이 읽을 수 있다. 

<br>

2. 변경된 바이트 코드는 클래스 로더에게 전달한다.
    + 클래스 로더 과정
      1. 로드 : 바이트 코드를 가져와 JVM의 메모리에 로드한다.
      2. 검증 : 과정 중에서 가장 시간이 많이 걸리는 과정, 읽어들인 클래스가 자바 언어 명세(JAVA Language Specification) 및 JVM 명세에 명시된 대로 구성되어 있는지 검증.
      3. 준비 : 클래스가 필요로 하는 메모리 할당한다. (필드, 메소드, 인터페이스 등)
      4. 분석 : 클래스의 상수 풀 내 모든 심볼릭 레퍼런스를 다이렉트 레퍼런스로 변경.
      5. 초기화 : 클래스 변수들을 적절한 값으로 초기화 (static 필드)


<br>

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F99B467465B73D15111)

<br>

3. 클래스 로더는 동적 로딩(Dynamic loading)을 통해 필요한 클래스들을 로딩 및 링크하여 각 런타임 데이터 영역에 할당함.
    + JVM이 OS 위에서 실행되면서 할당받는 메모리 영역이 런타임 데이터 영역이다.
    + PC Register, JVM Stack, Native Method Stack 은 스레드마다 하나씩 생성된다
    + 스레드(Thread)는 프로세스 내에서 실행되는 작업의 주체
    + 힙(Heap), 메소드 영역(Method Area)는 모든 스레드가 공유해서 사용된다
        1. PC Register : PC(Program Counter) 레지스터는 스레드가 시작될 때 생성되는 공간으로 각 스레드마다 하나씩 존재하며 현재 실행중인 명령을 저장한다.
        2. JVM 스택 : Stack Frame을 저장하는 역할. Stack 
        3. 네이티브 메소드 스택 : JAVA 외의 언어로 작성된 네이티브 코드를 위한 스택이다.
            + 네이티브 코드란 ? 이해못함
        4. 힙 : 객체 혹은 배열 생성을 저장하는 공간이다. 참조되지 않은 객체들은 가비지 컬렉션의 대상이다.
        5. 메소드 영역 : 맨 처음 메모리 공간에 올릴 때(JVM이 실행될 때) 생성된다. JVM이 읽은 각각의 클래스와 인터페이스에 대한 런타임 상수 풀, 필드 및 메소드 코드, 정적 변수 등을 보관함
        6. 런타임 상수 풀(Runtime Constant Pool) : 메소드와 필드에 대한 모든 레퍼런스까지 담고 있다. 메소드와 필드의 참조 등 런타임 상수 풀을 통해 메소드나 필드의 주소를 참조한다.


<br>

4. 실행 엔진(Excution Engine)은 JVM 메모리에 올라온 바이트 코드들을 가져와서 실행한다.
    + 실행 엔진은 런타임 데이터 영역에 배치된 바이트 코드를 명령어 단위로 읽어서 실행한다
    + 위의 실행 방법을 컴퓨터가 읽을 수 있는 형태로 변경한다.
        1. 인터프리티 : 바이트 코드 명령어를 하나씩 읽어서 해석하고 실행. 하나하나는 빠르지만 전체적인 속도는 느리다. JVM안에서 기본적으로 이 방식으로 동작한다
        2. JIT(just-in-time) 컴파일러 : 인터프리티의 단점을 보완하기 위해 생긴 방식. 바이트 코드 전체를 컴파일하여 네이티브 코드로 변경 후 네이티브 코드로 직접 실행한다
        
